openapi: 3.0.0

info:
  title: Broker Connect API
  version: 2.0.0
  description: DTO-based API documentation for Broker Connect backend

servers:
  - url: http://localhost:4000/api/v1
    description: Local
  - url: https://serverbrokerconnect-h34t.vercel.app/api/v1
    description: Production

paths:

  /auth/register:
    post:
      summary: Register a new broker
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '200':
          description: Broker created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrokerResponse'
        '409':
          $ref: '#/components/responses/ConflictError'

  /auth/login:
    post:
      summary: Login broker
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: JWT token returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /auth/logout:
    post:
      summary: Logout broker
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'

  /auth/me:
    get:
      summary: Get current broker
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current broker data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrokerResponse'

  /properties:
    post:
      summary: Create property draft
      tags: [Properties]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PropertyCreateRequest'
      responses:
        '201':
          description: Property created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PropertyResponse'

  /properties/{id}:
    get:
      summary: Get property by ID
      tags: [Properties]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Property details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PropertyResponse'

    patch:
      summary: Update property draft
      tags: [Properties]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PropertyUpdateRequest'
      responses:
        '200':
          description: Updated property
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PropertyResponse'

    delete:
      summary: Delete property
      tags: [Properties]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Property deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /properties/{id}/submit:
    post:
      summary: Submit property for verification
      tags: [Properties]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Property submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PropertyResponse'

  /properties/{id}/renew:
    post:
      summary: Renew property
      tags: [Properties]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PropertyRenewRequest'
      responses:
        '200':
          description: Property renewed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PropertyResponse'

  /properties/me:
    get:
      summary: Get broker properties
      tags: [Properties]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: status
          required: false
          schema:
            type: string
            enum: [ACTIVE, EXPIRED]
          description: Filter properties by status
      responses:
        '200':
          description: List of properties
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PropertyResponse'

  /properties/public:
    get:
      summary: Get public verified properties
      tags: [Properties]
      parameters:
        - in: query
          name: city
          required: false
          schema:
            type: string
          description: Filter by city

        - in: query
          name: bhkType
          required: false
          schema:
            type: string
            enum: [1RK, 1BHK, 2BHK, 3BHK, 4BHK, 4+BHK]
          description: Filter by BHK type

        - in: query
          name: propertyType
          required: false
          schema:
            type: string
            enum: [APARTMENT, ROW_HOUSE_OR_BUNGALOW, STUDIO, PENT_HOUSE_OR_DUPLEX]
          description: Filter by property type

      responses:
        '200':
          description: List of public verified properties
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PropertyResponse'

components:

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    # ================= AUTH =================

    RegisterRequest:
      type: object
      required: [fname, lname, dob, phone, email, password]
      properties:
        fname: { type: string }
        lname: { type: string }
        dob:
          type: string
          format: date
        phone: { type: string }
        email:
          type: string
          format: email
        password:
          type: string

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string }
        password: { type: string }

    LoginResponse:
      type: object
      properties:
        token:
          type: string

    BrokerResponse:
      type: object
      properties:
        id:
          type: string
        fname:
          type: string
        lname:
          type: string
        dob:
          type: string
          format: date
        phone:
          type: string
        email:
          type: string
        role:
          type: string
        status:
          type: string
        createdAt:
          type: string
          format: date-time

    # ================= PROPERTY REQUEST =================

    PropertyCreateRequest:
      type: object
      required: [listingType, propertyType, bhkType, address]
      properties:
        listingType:
          type: string
          enum: [RENT, SALE]
        propertyType:
          type: string
          enum: [APARTMENT, ROW_HOUSE_OR_BUNGALOW, STUDIO, PENT_HOUSE_OR_DUPLEX]
        propertyAge:
          type: string
          enum: [NEW, LESS_THAN_5_YEARS, 5_TO_10_YEARS, GREATER_THAN_10_YEARS]
        furnishing:
          type: string
          enum: [UN_FURNISHED, SEMI_FURNISHED, FULLY_FURNISHED]
        bhkType:
          type: string
          enum: [1RK, 1BHK, 2BHK, 3BHK, 4BHK, 4+BHK]
        address:
          $ref: '#/components/schemas/AddressRequest'
        floor:
          $ref: '#/components/schemas/Floor'
        area:
          $ref: '#/components/schemas/Area'
        images:
          type: array
          items:
            $ref: '#/components/schemas/Image'
        expiresAt:
          type: string
          format: date-time

    PropertyUpdateRequest:
      type: object
      properties:
        listingType: { type: string }
        propertyType: { type: string }
        propertyAge: { type: string }
        furnishing: { type: string }
        bhkType: { type: string }
        address:
          $ref: '#/components/schemas/AddressRequest'
        floor:
          $ref: '#/components/schemas/Floor'
        area:
          $ref: '#/components/schemas/Area'
        images:
          type: array
          items:
            $ref: '#/components/schemas/Image'
        expiresAt:
          type: string
          format: date-time

    PropertyRenewRequest:
      type: object
      required: [expiresAt]
      properties:
        expiresAt:
          type: string
          format: date-time

    # ================= PROPERTY RESPONSE (DTO) =================

    PropertyResponse:
      type: object
      properties:
        id:
          type: string
        listingType:
          type: string
        status:
          type: string
          example: ACTIVE
        brokerName:
          type: string
          example: Rajesh Patel
        postedAt:
          type: string
          format: date-time
        propertyType:
          $ref: '#/components/schemas/EnumWithLabel'
        propertyAge:
          $ref: '#/components/schemas/EnumWithLabel'
        furnishing:
          $ref: '#/components/schemas/EnumWithLabel'
        bhkType:
          type: string
        address:
          $ref: '#/components/schemas/AddressResponse'
        floor:
          $ref: '#/components/schemas/Floor'
        area:
          $ref: '#/components/schemas/Area'
        images:
          type: array
          items:
            $ref: '#/components/schemas/Image'
        expiresAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    EnumWithLabel:
      type: object
      properties:
        value:
          type: string
        label:
          type: string

    AddressRequest:
      type: object
      properties:
        line1: { type: string }
        line2: { type: string }
        landmark: { type: string }
        locality: { type: string }
        city: { type: string }
        state: { type: string }
        country: { type: string }
        pincode: { type: string }

    AddressResponse:
      type: object
      properties:
        line1: { type: string }
        locality: { type: string }
        city: { type: string }
        state: { type: string }
        pincode: { type: string }

    Floor:
      type: object
      properties:
        totalFloors:
          type: integer
        level:
          type: string
          enum: [LOWER, MIDDLE, HIGHER]

    Area:
      type: object
      properties:
        carpet:
          type: number
        builtUp:
          type: number

    Image:
      type: object
      properties:
        url:
          type: string
        type:
          type: string
          enum: [INTERIOR, EXTERIOR, FLOORPLAN, VIDEO]
        isPrimary:
          type: boolean

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true

    MessageResponse:
      type: object
      properties:
        message:
          type: string

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        errors:
          type: object

  responses:
    UnauthorizedError:
      description: Unauthorized access
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    ConflictError:
      description: Resource conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
